#!/usr/bin/env node

/**
 * Create a valid PDF file that can be parsed by pdf-parse
 * Uses raw PDF format instead of a library
 */

const fs = require('fs').promises;
const path = require('path');

async function createSimplePDF(outputPath) {
  // Minimal but valid PDF format
  const pdf = `%PDF-1.4
1 0 obj
<< /Type /Catalog /Pages 2 0 R >>
endobj
2 0 obj
<< /Type /Pages /Kids [3 0 R] /Count 1 >>
endobj
3 0 obj
<< /Type /Page /Parent 2 0 R /MediaBox [0 0 612 792] /Contents 4 0 R /Resources << /Font << /F1 5 0 R >> >> >>
endobj
4 0 obj
<< /Length 200 >>
stream
BT
/F1 24 Tf
100 700 Td
(Test PDF Document) Tj
0 -40 Td
/F1 12 Tf
(Generated by PDF creation utility) Tj
0 -30 Td
(This is a simple PDF file for testing text extraction) Tj
0 -30 Td
(Page 1 of 2) Tj
ET
endstream
endobj
5 0 obj
<< /Type /Font /Subtype /Type1 /BaseFont /Helvetica >>
endobj
xref
0 6
0000000000 65535 f
0000000009 00000 n
0000000058 00000 n
0000000115 00000 n
0000000240 00000 n
0000000496 00000 n
trailer
<< /Size 6 /Root 1 0 R >>
startxref
583
%%EOF`;

  await fs.writeFile(outputPath, pdf);
  console.log('âœ“ Valid PDF created:', outputPath);
}

async function main() {
  try {
    const testDir = path.join(__dirname, 'test-files');
    await fs.mkdir(testDir, { recursive: true });
    const pdfPath = path.join(testDir, 'simple-valid.pdf');
    await createSimplePDF(pdfPath);
  } catch (error) {
    console.error('Error:', error.message);
    process.exit(1);
  }
}

main();
